{"version":3,"file":"js/668.daacf308.js","mappings":"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","sources":["webpack://@zazuko/spex/./src/views/ShaclEditor.vue","webpack://@zazuko/spex/./node_modules/@rdf-esm/formats-common/parsers.js","webpack://@zazuko/spex/./node_modules/@rdf-esm/formats-common/serializers.js","webpack://@zazuko/spex/./node_modules/@rdf-esm/sink-map/index.js","webpack://@zazuko/spex/./node_modules/@rdf-esm/formats-common/index.js","webpack://@zazuko/spex/./src/views/ShaclEditor.vue?a28c"],"sourcesContent":["<template>\n  <Splitpanes class=\"default-theme\">\n    <Pane size=\"40\">\n      <h2 class=\"font-bold text-lg px-4 py-2 bg-gray-200\">SHACL editor</h2>\n      <rdf-editor class=\"w-full h-full overflow-hidden\" :format=\"format\" :value=\"shacl\" ref=\"shaclEditor\" />\n      <div class=\"field\">\n        <label class=\"label\" for=\"format\">Format</label>\n        <div class=\"select\">\n          <select id=\"format\" v-model=\"format\">\n            <option v-for=\"format in formats\" :key=\"format\" :value=\"format\">\n              {{ format }}\n            </option>\n          </select>\n        </div>\n      </div>\n      <button class=\"button is-primary\" @click=\"loadShacl\">\n        <ArrowPathIcon class=\"icon\" />\n        <span>Update</span>\n      </button>\n    </Pane>\n    <Pane>\n      <Splitpanes horizontal>\n        <Pane>\n          <div class=\"flex-grow flex flex-col\">\n            <h2 class=\"font-bold text-lg px-4 py-2 bg-gray-200\">Representation</h2>\n\n            <GraphLayout :nodes=\"datamodel.tables\" :links=\"links\" :active-links=\"activeLinks\">\n              <template v-slot:node=\"{ node }\">\n                <ResourceCard :resource=\"node\" :active-links=\"activeLinks\" />\n              </template>\n            </GraphLayout>\n\n            <div class=\"section\" v-if=\"error\">\n              <div class=\"message is-danger\">\n                <div class=\"message-body\">\n                  Error loading data: {{ error }}\n                </div>\n              </div>\n            </div>\n          </div>\n        </Pane>\n      </Splitpanes>\n    </Pane>\n  </Splitpanes>\n</template>\n\n<script>\nimport { ArrowPathIcon } from '@heroicons/vue/24/solid'\nimport { shrink as _shrink } from '@zazuko/rdf-vocabularies/shrink'\nimport { GraphLayout } from '@zazuko/vue-graph-layout'\nimport { Splitpanes, Pane } from 'splitpanes'\nimport 'splitpanes/dist/splitpanes.css'\nimport '@rdfjs-elements/rdf-editor'\nimport { parsers } from '@rdf-esm/formats-common'\nimport rdfEnvironment from 'rdf-ext'\nimport { tablesFromSHACL } from '@/shacl'\nimport { rdf, sh } from '@/namespace'\nimport ResourceCard from '@/components/ResourceCard.vue'\n\nconst formats = [...parsers.keys()]\n\nconst initialEditorContent = `\n@prefix sh: <http://www.w3.org/ns/shacl#> .\n@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .\n`\n\nexport default {\n  components: {\n    GraphLayout,\n    Splitpanes,\n    Pane,\n    ArrowPathIcon,\n    ResourceCard,\n  },\n\n  data() {\n    return {\n      format: 'text/turtle',\n      formats,\n      shacl: initialEditorContent,\n      datamodel: {\n        tables: [],\n        viewports: [],\n        isIntrospected: false,\n      },\n      error: null,\n      activeLinks: [],\n    }\n  },\n\n  computed: {\n    links() {\n      const tables = this.datamodel.tables\n      const tableIds = new Set(tables.map(({ id }) => id))\n      return tables\n        .flatMap(table => table.properties.map((property) => ({ ...property, table })))\n        .reduce((acc, property) => {\n          property.values.forEach((value) => {\n            const source = property.table.id\n            const target = value.id\n            if (tableIds.has(target)) {\n              acc.push({ source, target, sourceProperty: property.id, label: property.name })\n            }\n          })\n\n          return acc\n        }, [])\n    },\n  },\n\n  methods: {\n    async loadShacl() {\n      const editor = this.$refs.shaclEditor\n\n      this.error = null\n      this.datamodel.tables = []\n\n      const shrink = (uri) => _shrink(uri) || uri\n\n      try {\n        const quads = await editor.quads\n        const dataset = rdfEnvironment.dataset(quads)\n        const shapes = rdfEnvironment.clownface({ dataset }).has(rdf.type, sh.NodeShape)\n        this.datamodel.tables = tablesFromSHACL(shapes, shrink)\n      } catch (e) {\n        this.error = e.toString()\n      }\n    }\n  }\n}\n</script>\n","export async function jsonLdParser () {\n  const JsonLdParser = (await import('@rdfjs/parser-jsonld')).default\n\n  return new JsonLdParser()\n}\n\nexport async function n3Parser () {\n  const N3Parser = (await import('@rdfjs/parser-n3')).default\n  return new N3Parser()\n}\n\nexport async function rdfXmlParser () {\n  const module = await import('rdfxml-streaming-parser')\n\n  let RdfXmlParser\n  if (module.default) {\n    RdfXmlParser = module.default.RdfXmlParser\n  } else {\n    RdfXmlParser = module.RdfXmlParser\n  }\n\n  return new RdfXmlParser()\n}\n","export async function jsonLdSerializer () {\n  const JsonLdSerializer = (await import('@rdfjs/serializer-jsonld')).default\n\n  return new JsonLdSerializer({ encoding: 'string' })\n}\n\nexport async function nTriplesSerializer () {\n  const NTriplesSerializer = (await import('@rdfjs/serializer-ntriples')).default\n\n  return new NTriplesSerializer()\n}\n","import stream from 'readable-stream'\n\nclass SinkMap extends Map {\n  import (key, input, options) {\n    const sink = this.get(key)\n\n    if (!sink) {\n      return null\n    }\n\n    if (typeof sink === 'function') {\n      const passThrough = new stream.PassThrough({ objectMode: true })\n      Promise.resolve().then(async () => {\n        const sinkInstance = await sink()\n        this.set(key, sinkInstance)\n\n        const origStream = sinkInstance.import(input, options)\n        origStream.on('prefix', (prefix, ns) => {\n          passThrough.emit('prefix', prefix, ns)\n        })\n        origStream.on('error', err => {\n          passThrough.emit('error', err)\n          passThrough.emit('end')\n        })\n\n        origStream.pipe(passThrough)\n      })\n\n      return passThrough\n    }\n\n    return sink.import(input, options)\n  }\n}\n\nexport { SinkMap }\n","import {\n  jsonLdParser,\n  n3Parser,\n  rdfXmlParser\n} from './parsers.js'\nimport {\n  jsonLdSerializer,\n  nTriplesSerializer\n} from './serializers.js'\nimport { SinkMap } from '@rdf-esm/sink-map'\n\nconst parserMap = new SinkMap()\nconst serializerMap = new SinkMap()\n\nparserMap.set('application/ld+json', jsonLdParser)\nparserMap.set('application/trig', n3Parser)\nparserMap.set('application/n-quads', n3Parser)\nparserMap.set('application/n-triples', n3Parser)\nparserMap.set('text/n3', n3Parser)\nparserMap.set('text/turtle', n3Parser)\nparserMap.set('application/rdf+xml', rdfXmlParser)\n\nserializerMap.set('application/ld+json', jsonLdSerializer)\nserializerMap.set('application/n-quads', nTriplesSerializer)\nserializerMap.set('application/n-triples', nTriplesSerializer)\nserializerMap.set('text/n3', nTriplesSerializer)\nserializerMap.set('text/turtle', nTriplesSerializer)\n\nexport const parsers = parserMap\nexport const serializers = serializerMap\n","import { render } from \"./ShaclEditor.vue?vue&type=template&id=1848c353\"\nimport script from \"./ShaclEditor.vue?vue&type=script&lang=js\"\nexport * from \"./ShaclEditor.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["_createElementVNode","class","for","_createBlock","_component_Splitpanes","_createVNode","_component_Pane","size","_hoisted_1","_component_rdf_editor","format","$data","value","shacl","ref","_hoisted_2","_hoisted_3","_hoisted_4","id","$event","_createElementBlock","_Fragment","_renderList","formats","key","_hoisted_5","onClick","_cache","args","$options","loadShacl","_component_ArrowPathIcon","_hoisted_6","horizontal","_hoisted_7","_hoisted_8","_component_GraphLayout","nodes","datamodel","tables","links","activeLinks","node","_withCtx","_component_ResourceCard","resource","error","_hoisted_9","_hoisted_10","_hoisted_11","_toDisplayString","async","jsonLdParser","JsonLdParser","default","n3Parser","N3Parser","rdfXmlParser","module","RdfXmlParser","jsonLdSerializer","JsonLdSerializer","encoding","nTriplesSerializer","NTriplesSerializer","SinkMap","Map","import","input","options","sink","this","get","passThrough","objectMode","Promise","resolve","then","sinkInstance","set","origStream","on","prefix","ns","emit","err","pipe","parserMap","serializerMap","parsers","keys","initialEditorContent","components","GraphLayout","Splitpanes","Pane","ArrowPathIcon","ResourceCard","data","viewports","isIntrospected","computed","tableIds","Set","map","flatMap","table","properties","property","reduce","acc","values","forEach","source","target","has","push","sourceProperty","label","name","methods","editor","$refs","shaclEditor","shrink","uri","_shrink","quads","dataset","rdfEnvironment","shapes","clownface","rdf","type","sh","NodeShape","tablesFromSHACL","e","toString","__exports__","render"],"sourceRoot":""}